[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Post Dated Cheques",
  "enabled": 1,
  "modified": "2024-07-22 11:58:21.810291",
  "module": "Aqiq Pdc",
  "name": "Post Dated Cheques",
  "script": "frappe.ui.form.on('Post Dated Cheques', {\n    refresh(frm){\n       if (frm.is_new()){\n\t        frm.doc.status='Pending';\n\t        frm.refresh_field('status');\n\t    }  \n    },\n    currency(frm){\n        get_ex(frm);\n    },\n    company_currency(frm){\n        get_ex(frm);\n    },\n    posting_date(frm){\n        get_ex(frm);\n    },\n    amount(frm){\n        frm.set_value(\"base_amount\", frm.doc.amount*frm.doc.target_exchange_rate)  \n    },\n    target_exchange_rate(frm){\n        frm.set_value(\"base_amount\", frm.doc.amount*frm.doc.target_exchange_rate)  \n    },\n    payment_type(frm){\n        if(!frm.doc.party){\n            if(frm.doc.payment_type == \"Receive\"){\n                frm.set_value(\"party_type\", \"Customer\")\n            }\n            else{\n                frm.set_value(\"party_type\", \"Supplier\")\n            }\n        }\n    },\n\tsetup(frm) {\n\t    frm.set_query(\"party_type\", function() {\n\t\t\treturn {\n\t\t\t\tfilters: [\n\t\t\t\t\t[\"DocType\",\"name\", \"in\", [\"Customer\", \"Supplier\"]],\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\t\t\n\t\tcur_frm.set_query(\"party\",function() {\n        \treturn {\n        \t    filters:{\"company\": cur_frm.doc.company}\n        \t}\n        });\n\t},\n\tparty(frm){\n\t    if(frm.doc.party_type=='Customer' && frm.doc.party!=null){\n\t        frappe.db.get_value('Customer', frm.doc.party, 'customer_name')\n\t        .then(r=>{\n\t            frm.doc.party_name=r.message.customer_name;\n\t            frm.refresh_field('party_name');\n\t        });\n\t    }\n\t    if(frm.doc.party_type=='Supplier' && frm.doc.party!=null){\n\t        frappe.db.get_value('Supplier', frm.doc.party, 'supplier_name')\n\t        .then(r=>{\n\t            frm.doc.party_name=r.message.supplier_name;\n\t            frm.refresh_field('party_name');\n\t        })\n\t    }\n\t}\n})\n\nvar get_ex = function(frm){\n    if(frm.doc.currency && frm.doc.company_currency){\n        frappe.call({\n            method:\"erpnext.setup.utils.get_exchange_rate\",\n            args:{\n                'from_currency':frm.doc.currency,\n                'to_currency':frm.doc.company_currency,\n                'transaction_date':frm.doc.posting_date,\n            },\n            callback:function(r){\n                var res = r.message;\n                console.log(res)\n                if(res){\n                    frm.set_value(\"target_exchange_rate\", res)\n                }\n            }\n        })\n    }\n}",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Post Dated Cheques Tool",
  "enabled": 1,
  "modified": "2024-07-22 12:51:42.050588",
  "module": "Aqiq Pdc",
  "name": "Post Dated Cheques Tool",
  "script": "cur_frm.set_query(\"bank_account\", \"details\", function(frm, cdt, cdn) {\n    var d = locals[cdt][cdn];\n\treturn {\n\t    filters: [\n\t\t\t[\"Account\",\"account_type\", \"=\", \"Bank\"],\n\t\t\t[\"Account\",\"company\", \"=\", d.company],\n\t\t]\n\t}\n});\n\nfrappe.ui.form.on('Post Dated Cheques Tool', {\n\trefresh(frm) {\n        frm.set_query(\"default_bank_account\", function() {\n\t\t\treturn {\n\t\t\t\tfilters: [\n\t\t\t\t\t[\"Account\",\"account_type\", \"=\", \"Bank\"],\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\t},\n\tapply_bank(frm){\n\t    var selected = frm.get_selected()[\"details\"]\n\t    console.log(selected)\n\t    for(var d in frm.doc.details){\n\t        for(var i in selected){\n\t            if(selected[i] == frm.doc.details[d].name && frm.doc.details[d].company_currency == frm.doc.account_currency){\n\t                frm.doc.details[d].bank_account = frm.doc.default_bank_account;       \n\t            }\n\t        }\n\t    }\n\t    frm.refresh_field(\"details\")\n\t},\n\tget_posted_dated_cheques(frm){\n\t    frm.doc.details = []\n\t    frm.refresh_field(\"details\")\n\t    frappe.call({\n            method:\"aqiq_pdc.aqiq_pdc.doctype.post_dated_cheques_tool.post_dated_cheques_tool.get_post_dated_cheques\",\n            args:{\n                'company':frm.doc.company,\n                'cost_center':frm.doc.cost_center,\n                'department':frm.doc.department,\n                'from_date':frm.doc.from_date,\n                'to_date':frm.doc.to_date,\n            },\n            callback:function(r){\n                var res = r.message;\n                if(res){\n                    console.log(res)\n                    for(var d in res){\n                        var i = frm.add_child(\"details\", res[d])\n                    }\n                    frm.refresh_field(\"details\")\n                }\n            }\n        })\n\t},\n})",
  "view": "Form"
 }
]